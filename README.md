## Тестовое задание от Inside24
___

### Задача:

Создать сервис, обеспечивающий выдачу jwt токена авторизованному пользователю,
а также прием сообщений от пользователя с валидным токеном.

### Реализация:

Многомодульный maven-проект (родительский и дочерние pom) на базе SpringBoot v2.7.2.<br>
Два сервиса, каждый использующий свою базу Postgres, собраны с помощью
[docker-compose.yml](docker-compose.yml).

##### Сервис №1 (token-service):

Осуществляет выдачу jwt токена пользователю с правильным паролем, а также проверяет
валидность присланного токена.<br>
**Эндпоинт: POST http://localhost:7070/authenticate** принимает имя пользователя и пароль.
Сверив пользователя и пароль с таблицей **authentications:**
* если токена еще нет (таблица **tokens**) или он истек, генерирует новый и возвращает
* иначе выдает имеющийся

**Эндпоинт: GET http://localhost:7070/authenticate** принимает параметром имя пользователя
и токен в заголовке. Проверяет токен на валидность, принадлежность и выдает соответсвующий
ответ:
* correct token
* token owner is incorrect
* token is incorrect or expired

##### Сервис №2 (server):

**Эндпоинт: POST http://localhost:9090/message** принимает сообщения от пользователя
с токеном в заголовке, выполняет сверку токена в Сервисе №1, если успешно то выполняет
действие:
* если сообщение содержит **history XX** (XX - число), то выдает список последних XX 
сообщений пользователя из таблицы **messages**
* иначе сохраняет сообщение  

Для связи между сервисами использован Feign Client.

### Docker:

Необходимые компоненты (2 сервиса и 2 базы данных) собираются в контейнерах посредством
[docker-compose.yml](docker-compose.yml) с учетом зависимостей друг от друга.
Образы сервисов на Docker Hub:<br>
* [Сервис №1](https://hub.docker.com/repository/docker/kirillkormilcev/token-service-image)
* [Сервис №2](https://hub.docker.com/repository/docker/kirillkormilcev/server-image)

### Тесты:
Выполнено JUnit тестирование с использованием Mockito, rest тестирование (MockMvc), @JsonTest,
@DataJpaTest, а также интеграционное тестирование @SpringBootTest.<br>
Кроме того создана коллекция тестов [Postman](resources/Inside24.postman_collection.json).
Для их корректной работы необходимо токены, полученные в первых двух тестах заменить в
переменных всей коллекции (token_user1, token_user2), после этого можно прогонять всю коллекцию.
Для проверки работоспособности сервисов создана серия запросов [curl](resources/curl.txt)
с пояснениями.

### P.S.

Для удобства тестирования и проверки сервисов в **token-service** оставлен
[data.sql](token-service/src/main/resources/data.sql) с данными двух пользователей.
По этой же причине конфиденциальные данные не вынесены в .env.<br>
Код старался писать так, чтобы не было необходимости в комментариях.